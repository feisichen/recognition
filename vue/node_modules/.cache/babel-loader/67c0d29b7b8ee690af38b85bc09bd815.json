{"ast":null,"code":"import { ArrowLeft } from '@element-plus/icons-vue';\nimport request from \"@/utils/request\";\nimport * as echarts from \"echarts\";\nexport default {\n  name: \"TeacherGrade\",\n\n  data() {\n    return {\n      ArrowLeft,\n      id: sessionStorage.getItem(\"id\"),\n      courseId: sessionStorage.getItem(\"currentCourse\"),\n      courseName: sessionStorage.getItem(\"currentCourseName\"),\n      teacherId: sessionStorage.getItem(\"currentId\"),\n      teacherName: sessionStorage.getItem(\"currentName\"),\n      term: sessionStorage.getItem(\"currentTerm\"),\n      time: sessionStorage.getItem(\"currentTime\"),\n      weight: sessionStorage.getItem(\"currentWeight\"),\n      credit: sessionStorage.getItem(\"currentCredit\"),\n      limitNum: sessionStorage.getItem(\"currentLimitNum\"),\n      currentNum: sessionStorage.getItem(\"currentCurrentNum\"),\n      tableData: [],\n      grade1: null,\n      grade2: null,\n      row: {},\n      isequal: true,\n      isvalid: true,\n      badGrade: false,\n      disagreeGrade: false\n    };\n  },\n\n  created() {\n    this.load();\n  },\n\n  methods: {\n    load() {\n      request.get(\"/grade/forGrade\", {\n        params: {\n          term: this.term,\n          courseId: this.courseId,\n          teacherId: this.teacherId,\n          time: this.time\n        }\n      }).then(res => {\n        console.log(res);\n        this.tableData = res.data.list;\n        this.total = res.data.total;\n      });\n    },\n\n    usualGrade() {\n      // 跳转路由\n      this.$router.push(\"/usualGrade\");\n    },\n\n    finalGrade() {\n      // 跳转路由\n      this.$router.push(\"/finalgrade\");\n    },\n\n    // handleGrade(row) {\n    //   this.form.usualGrade = row.usualGrade;\n    //   this.form.finalGrade = row.finalGrade;\n    //   this.title = row.id + \"-\" + row.name + \"的成绩信息\";\n    //\n    //   this.row.studentId = row.id;\n    //   this.row.teacherId = this.teacherId;\n    //   this.row.courseId = this.courseId;\n    //   this.row.term = this.term;\n    //   this.row.time = this.time;\n    //   this.dialogVisible = true;\n    // },\n    save() {\n      let index = 0;\n\n      for (index = 0; index < this.tableData.length; index++) {\n        if (this.tableData[index].grade1 !== this.tableData[index].grade2) {\n          this.isequal = false;\n        }\n\n        if (this.tableData[index].grade1 > 100 || this.tableData[index].grade1 < 0 || this.tableData[index].grade2 > 100 || this.tableData[index].grade2 < 0) {\n          this.isvalid = false;\n        }\n      }\n\n      if (this.isvalid === true && this.isequal === true) {\n        for (index = 0; index < this.tableData.length; index++) {\n          request.get(\"/grade/usualGrade\", {\n            params: {\n              term: this.term,\n              courseId: this.courseId,\n              teacherId: this.teacherId,\n              time: this.time,\n              studentId: this.tableData[index].id,\n              grade: this.tableData[index].grade1\n            }\n          }).then(res => {});\n        }\n\n        this.$message({\n          type: 'success',\n          message: '平时成绩提交成功'\n        });\n      } else if (this.isvalid === false) {\n        this.badGrade = true;\n      } else if (this.isequal === false) {\n        this.disagreeGrade = true;\n      }\n    },\n\n    getTotalGrade() {\n      // 此处可以保留上次输入的数据\n      // this.form2 = {};\n      this.dialogVisible2 = true;\n    },\n\n    back() {\n      if (this.needToUpdate) {\n        this.$message({\n          type: 'warning',\n          message: '综合成绩未更新'\n        });\n        return;\n      } else {\n        this.$router.push('/teacherGrade');\n      }\n    },\n\n    update() {\n      // if (eval(this.form2.usualGradeProportion + \"+\" + this.form2.finalGradeProportion) !== 100) {\n      //   this.$message({\n      //     type: \"warning\",\n      //     message: \"数据不合法，请重新输入\"\n      //   })\n      //   this.form2 = {};\n      //   return;\n      // }\n      request.get(\"/grade/update\", {\n        params: {\n          term: this.term,\n          courseId: this.courseId,\n          teacherId: this.teacherId,\n          time: this.time,\n          usualGradeProportion: 1 - this.weight,\n          finalGradeProportion: this.weight\n        }\n      }).then(res => {\n        console.log(res);\n\n        if (res.code === '0') {\n          this.$message({\n            type: 'success',\n            message: '综合成绩更新成功'\n          });\n          this.needToUpdate = false;\n          this.load();\n          this.dialogVisible2 = false;\n        } else {\n          this.$message({\n            type: 'error',\n            message: res.msg\n          });\n        }\n      });\n    },\n\n    displayGrade() {\n      if (this.tableData.length === 0) {\n        this.$message({\n          type: \"warning\",\n          message: \"暂无学生选课\"\n        });\n        return;\n      }\n\n      let usualDistributionData = [{\n        value: 0,\n        name: '90分-100分'\n      }, {\n        value: 0,\n        name: '80分-89分'\n      }, {\n        value: 0,\n        name: '70分-79分'\n      }, {\n        value: 0,\n        name: '60-69分'\n      }, {\n        value: 0,\n        name: '60分以下'\n      }];\n      let finalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\n      let totalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\n      this.initDistributionData(usualDistributionData, 1);\n      this.initDistributionData(finalDistributionData, 2);\n      this.initDistributionData(totalDistributionData, 3);\n      this.dialogVisible3 = true;\n      this.$nextTick(() => {\n        let myChart = echarts.init(document.getElementById(\"usualDistribution\"));\n        let myChart2 = echarts.init(document.getElementById(\"finalDistribution\"));\n        let myChart3 = echarts.init(document.getElementById(\"totalDistribution\"));\n        let option = {\n          title: {\n            text: '平时成绩',\n            left: 'center'\n          },\n          tooltip: {\n            trigger: 'item'\n          },\n          legend: {\n            top: '5%',\n            left: 'center'\n          },\n          series: [{\n            name: '该分数段人数',\n            type: 'pie',\n            radius: ['40%', '70%'],\n            avoidLabelOverlap: false,\n            itemStyle: {\n              borderRadius: 10,\n              borderColor: '#fff',\n              borderWidth: 2\n            },\n            label: {\n              show: false,\n              position: 'center'\n            },\n            emphasis: {\n              label: {\n                show: true,\n                fontSize: '40',\n                fontWeight: 'bold'\n              }\n            },\n            labelLine: {\n              show: false\n            },\n            data: usualDistributionData\n          }]\n        };\n        myChart.setOption(option);\n        let option2 = JSON.parse(JSON.stringify(option));\n        option2.title.text = \"考试成绩\";\n        option2.series[0].data = finalDistributionData;\n        myChart2.setOption(option2);\n        let option3 = JSON.parse(JSON.stringify(option));\n        option3.title.text = \"综合成绩\";\n        option3.series[0].data = totalDistributionData;\n        myChart3.setOption(option3); // 算平均分\n\n        let usualSum = 0,\n            finalSum = 0,\n            totalSum = 0;\n\n        for (let i = 0; i < this.tableData.length; i++) {\n          usualSum += this.tableData[i].usualGrade;\n          finalSum += this.tableData[i].finalGrade;\n          totalSum += this.tableData[i].totalGrade;\n        }\n\n        console.log(usualSum);\n        console.log(finalSum);\n        console.log(totalSum);\n        this.usualAverage = (usualSum / this.tableData.length).toFixed(2);\n        this.finalAverage = (finalSum / this.tableData.length).toFixed(2);\n        this.totalAverage = (totalSum / this.tableData.length).toFixed(2);\n      });\n    },\n\n    initDistributionData(distributionData, which) {\n      let t;\n\n      for (let i = 0; i < this.tableData.length; i++) {\n        if (which === 1) {\n          t = this.tableData[i].usualGrade;\n        } else if (which === 2) {\n          t = this.tableData[i].finalGrade;\n        } else {\n          t = this.tableData[i].totalGrade;\n        }\n\n        if (t >= 90 && t <= 100) {\n          distributionData[0][\"value\"]++;\n        } else if (t >= 80 && t <= 89) {\n          distributionData[1][\"value\"]++;\n        } else if (t >= 70 && t <= 79) {\n          distributionData[2][\"value\"]++;\n        } else if (t >= 60 && t <= 69) {\n          distributionData[3][\"value\"]++;\n        } else {\n          distributionData[4][\"value\"]++;\n        }\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["ArrowLeft","request","echarts","name","data","id","sessionStorage","getItem","courseId","courseName","teacherId","teacherName","term","time","weight","credit","limitNum","currentNum","tableData","grade1","grade2","row","isequal","isvalid","badGrade","disagreeGrade","created","load","methods","get","params","then","res","console","log","list","total","usualGrade","$router","push","finalGrade","save","index","length","studentId","grade","$message","type","message","getTotalGrade","dialogVisible2","back","needToUpdate","update","usualGradeProportion","finalGradeProportion","code","msg","displayGrade","usualDistributionData","value","finalDistributionData","JSON","parse","stringify","totalDistributionData","initDistributionData","dialogVisible3","$nextTick","myChart","init","document","getElementById","myChart2","myChart3","option","title","text","left","tooltip","trigger","legend","top","series","radius","avoidLabelOverlap","itemStyle","borderRadius","borderColor","borderWidth","label","show","position","emphasis","fontSize","fontWeight","labelLine","setOption","option2","option3","usualSum","finalSum","totalSum","i","totalGrade","usualAverage","toFixed","finalAverage","totalAverage","distributionData","which","t"],"sourceRoot":"","sources":["D:\\code\\Java\\class_choose\\vue\\src\\views\\UsualGrade.vue"],"sourcesContent":["<template>\r\n  <div style=\"margin: 10px;\">\r\n    <el-button type=\"primary\" plain :icon=\"ArrowLeft\"\r\n               @click=\"back\">返回\r\n    </el-button>\r\n    <div style=\"text-align: center;\">\r\n      <h1 style=\"color: #409EFF;\">学生名单</h1>\r\n      <span >\r\n        课程号：<ins style=\"color: ;\">&nbsp;{{ id }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        课程名：<ins>&nbsp;{{ courseName }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        学期：<ins>&nbsp;{{ term }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        <!--        <br><br>-->\r\n        学分：<ins>&nbsp;{{ credit }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        教师号：<ins>&nbsp;{{ teacherId }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        教师名：<ins>&nbsp;{{ teacherName }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        时间：<ins>&nbsp;{{ time }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        考试成绩权重：<ins>&nbsp;{{ weight }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        <!--        <br><br>-->\r\n        选课人数上限：<ins>&nbsp;{{ limitNum }}&nbsp;</ins>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n        当前选课人数：<ins>&nbsp;{{ currentNum }}&nbsp;</ins>\r\n      </span>\r\n      <hr>\r\n\r\n      <!--表格-->\r\n      <el-table :data=\"tableData\" border stripe style=\"width: 100%;\">\r\n        <el-table-column prop=\"id\" label=\"学生学号\" sortable/>\r\n        <el-table-column prop=\"name\" label=\"学生姓名\"/>\r\n        <el-table-column fixed=\"right\" label=\"平时成绩\" width=\"480px\">\r\n          <template #default=\"scope\">\r\n            <el-input v-model=\"scope.row.grade1\" placeholder=\"请输入成绩\"  clearable/>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column fixed=\"right\" label=\"确认平时成绩\" width=\"480px\">\r\n          <template #default=\"scope\">\r\n            <el-input v-model=\"scope.row.grade2\" placeholder=\"请输入成绩\"  clearable/>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </div>\r\n\r\n    <el-row>\r\n      <el-col :span=\"12\">\r\n        <div style=\"margin: 10px 10px 10px; font-size: 10px; color: rgb(96, 98, 102);\">选课人数：{{ currentNum }}</div>\r\n      </el-col>\r\n      <el-col :span=\"4\">\r\n        <div style=\"margin-top: 15px; margin-left: 20px; color: red;\" v-if=\"badGrade\">输入成绩不合法，请确认！</div>\r\n      </el-col>\r\n      <el-col :span=\"4\">\r\n        <div style=\"margin-top: 15px; margin-left: 20px; color: red;\" v-if=\"disagreeGrade\">两次成绩不一致，请确认！</div>\r\n      </el-col>\r\n      <el-col :span=\"4\">\r\n        <el-button style=\"margin: 10px;\" type=\"primary\" plain @click=\"save\">提交</el-button>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <el-dialog v-model=\"dialogVisible\" :title=\"title\" width=\"30%\">\r\n      <el-form :model=\"form\" label-width=\"120px\">\r\n        <el-form-item label=\"平时成绩\">\r\n          <el-input v-model=\"form.usualGrade\" style=\"width: 80%;\"/>\r\n        </el-form-item>\r\n        <el-form-item label=\"考试成绩\">\r\n          <el-input v-model=\"form.finalGrade\" style=\"width: 80%;\"/>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n      <span>\r\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"save\">确 定</el-button>\r\n      </span>\r\n      </template>\r\n    </el-dialog>\r\n\r\n    <el-dialog v-model=\"dialogVisible2\" title=\"请输入平时分和考试分占比\" width=\"30%\">\r\n      <el-form :model=\"form2\" label-width=\"120px\">\r\n        <el-form-item label=\"平时成绩占比\">\r\n          <el-input v-model=\"form2.usualGradeProportion\" style=\"width: 40%;\"/>\r\n          <span>&nbsp;&nbsp;%</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"考试成绩占比\">\r\n          <el-input v-model=\"form2.finalGradeProportion\" style=\"width: 40%;\"/>\r\n          <span>&nbsp;&nbsp;%</span>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n      <span>\r\n        <el-button @click=\"dialogVisible2 = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"update\">确 定</el-button>\r\n      </span>\r\n      </template>\r\n    </el-dialog>\r\n\r\n    <el-dialog v-model=\"dialogVisible3\" width=\"80%\" title=\"成绩分布\">\r\n      <el-row>\r\n        <el-col :span=\"8\" style=\"height: 500px;\" id=\"usualDistribution\"></el-col>\r\n        <el-col :span=\"8\" style=\"height: 500px;\" id=\"finalDistribution\"></el-col>\r\n        <el-col :span=\"8\" style=\"height: 500px;\" id=\"totalDistribution\"></el-col>\r\n      </el-row>\r\n      <el-row>\r\n        <el-col :span=\"8\" style=\"height: 30px; font-weight:bold; text-align: center;\">平均分：{{ usualAverage }}</el-col>\r\n        <el-col :span=\"8\" style=\"height: 30px; font-weight:bold; text-align: center;\">平均分：{{ finalAverage }}</el-col>\r\n        <el-col :span=\"8\" style=\"height: 30px; font-weight:bold; text-align: center;\">平均分：{{ totalAverage }}</el-col>\r\n      </el-row>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {ArrowLeft} from '@element-plus/icons-vue'\r\nimport request from \"@/utils/request\";\r\nimport * as echarts from \"echarts\";\r\n\r\nexport default {\r\n  name: \"TeacherGrade\",\r\n  data() {\r\n    return {\r\n      ArrowLeft,\r\n      id: sessionStorage.getItem(\"id\"),\r\n      courseId: sessionStorage.getItem(\"currentCourse\"),\r\n      courseName: sessionStorage.getItem(\"currentCourseName\"),\r\n      teacherId: sessionStorage.getItem(\"currentId\"),\r\n      teacherName: sessionStorage.getItem(\"currentName\"),\r\n      term: sessionStorage.getItem(\"currentTerm\"),\r\n      time: sessionStorage.getItem(\"currentTime\"),\r\n      weight: sessionStorage.getItem(\"currentWeight\"),\r\n      credit: sessionStorage.getItem(\"currentCredit\"),\r\n      limitNum: sessionStorage.getItem(\"currentLimitNum\"),\r\n      currentNum: sessionStorage.getItem(\"currentCurrentNum\"),\r\n      \r\n      tableData: [],\r\n      grade1: null,\r\n      grade2: null,\r\n      row: {},\r\n      isequal: true,\r\n      isvalid: true,\r\n      badGrade: false,\r\n      disagreeGrade: false\r\n    }\r\n  },\r\n  created() {\r\n    this.load();\r\n  },\r\n  methods: {\r\n    load() {\r\n      request.get(\"/grade/forGrade\", {\r\n        params: {\r\n          term: this.term,\r\n          courseId: this.courseId,\r\n          teacherId: this.teacherId,\r\n          time: this.time\r\n        }\r\n      }).then(res => {\r\n        console.log(res);\r\n        this.tableData = res.data.list;\r\n        this.total = res.data.total;\r\n      })\r\n    },\r\n    usualGrade() {\r\n      // 跳转路由\r\n      this.$router.push(\"/usualGrade\");\r\n    },\r\n    finalGrade() {\r\n      // 跳转路由\r\n      this.$router.push(\"/finalgrade\");\r\n    },\r\n    // handleGrade(row) {\r\n    //   this.form.usualGrade = row.usualGrade;\r\n    //   this.form.finalGrade = row.finalGrade;\r\n    //   this.title = row.id + \"-\" + row.name + \"的成绩信息\";\r\n    //\r\n    //   this.row.studentId = row.id;\r\n    //   this.row.teacherId = this.teacherId;\r\n    //   this.row.courseId = this.courseId;\r\n    //   this.row.term = this.term;\r\n    //   this.row.time = this.time;\r\n    //   this.dialogVisible = true;\r\n    // },\r\n    save() {\r\n      let index=0;\r\n        for(index=0;index < this.tableData.length;index++){\r\n          if(this.tableData[index].grade1 !== this.tableData[index].grade2){\r\n            this.isequal = false;\r\n          }\r\n          if(this.tableData[index].grade1 > 100 || this.tableData[index].grade1 < 0 ||this.tableData[index].grade2 > 100 || this.tableData[index].grade2 < 0){\r\n            this.isvalid = false;\r\n          }\r\n      }\r\n        if(this.isvalid === true && this.isequal === true){\r\n          for(index=0;index < this.tableData.length;index++){\r\n            request.get(\"/grade/usualGrade\", {\r\n              params: {\r\n                term:this.term,\r\n                courseId:this.courseId,\r\n                teacherId:this.teacherId,\r\n                time:this.time,\r\n                studentId:this.tableData[index].id,\r\n                grade:this.tableData[index].grade1\r\n              }\r\n            }).then(res => {\r\n            })\r\n          }\r\n            this.$message({\r\n              type: 'success',\r\n              message: '平时成绩提交成功'\r\n            })\r\n        }\r\n        else if(this.isvalid === false){\r\n          this.badGrade = true;\r\n        }\r\n        else if(this.isequal === false){\r\n          this.disagreeGrade = true;\r\n        }\r\n    },\r\n    getTotalGrade() {\r\n      // 此处可以保留上次输入的数据\r\n      // this.form2 = {};\r\n      this.dialogVisible2 = true;\r\n    },\r\n    back() {\r\n      if (this.needToUpdate) {\r\n        this.$message({\r\n          type: 'warning',\r\n          message: '综合成绩未更新'\r\n        })\r\n        return;\r\n      } else {\r\n        this.$router.push('/teacherGrade');\r\n      }\r\n    },\r\n    update() {\r\n      // if (eval(this.form2.usualGradeProportion + \"+\" + this.form2.finalGradeProportion) !== 100) {\r\n      //   this.$message({\r\n      //     type: \"warning\",\r\n      //     message: \"数据不合法，请重新输入\"\r\n      //   })\r\n      //   this.form2 = {};\r\n      //   return;\r\n      // }\r\n      request.get(\"/grade/update\", {\r\n        params: {\r\n          term: this.term,\r\n          courseId: this.courseId,\r\n          teacherId: this.teacherId,\r\n          time: this.time,\r\n          usualGradeProportion: 1 - this.weight,\r\n          finalGradeProportion: this.weight\r\n        }\r\n      }).then(res => {\r\n        console.log(res);\r\n        if (res.code === '0') {\r\n          this.$message({\r\n            type: 'success',\r\n            message: '综合成绩更新成功'\r\n          })\r\n          this.needToUpdate = false;\r\n          this.load();\r\n          this.dialogVisible2 = false;\r\n        } else {\r\n          this.$message({\r\n            type: 'error',\r\n            message: res.msg\r\n          })\r\n        }\r\n      })\r\n    },\r\n    displayGrade() {\r\n      if (this.tableData.length === 0) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"暂无学生选课\"\r\n        })\r\n        return;\r\n      }\r\n      let usualDistributionData = [\r\n        {value: 0, name: '90分-100分'},\r\n        {value: 0, name: '80分-89分'},\r\n        {value: 0, name: '70分-79分'},\r\n        {value: 0, name: '60-69分'},\r\n        {value: 0, name: '60分以下'}\r\n      ];\r\n      let finalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\r\n      let totalDistributionData = JSON.parse(JSON.stringify(usualDistributionData));\r\n      this.initDistributionData(usualDistributionData, 1);\r\n      this.initDistributionData(finalDistributionData, 2);\r\n      this.initDistributionData(totalDistributionData, 3);\r\n      this.dialogVisible3 = true;\r\n      this.$nextTick(() => {\r\n        let myChart = echarts.init(document.getElementById(\"usualDistribution\"));\r\n        let myChart2 = echarts.init(document.getElementById(\"finalDistribution\"));\r\n        let myChart3 = echarts.init(document.getElementById(\"totalDistribution\"));\r\n        let option = {\r\n          title: {\r\n            text: '平时成绩',\r\n            left: 'center'\r\n          },\r\n          tooltip: {\r\n            trigger: 'item'\r\n          },\r\n          legend: {\r\n            top: '5%',\r\n            left: 'center'\r\n          },\r\n          series: [\r\n            {\r\n              name: '该分数段人数',\r\n              type: 'pie',\r\n              radius: ['40%', '70%'],\r\n              avoidLabelOverlap: false,\r\n              itemStyle: {\r\n                borderRadius: 10,\r\n                borderColor: '#fff',\r\n                borderWidth: 2\r\n              },\r\n              label: {\r\n                show: false,\r\n                position: 'center'\r\n              },\r\n              emphasis: {\r\n                label: {\r\n                  show: true,\r\n                  fontSize: '40',\r\n                  fontWeight: 'bold'\r\n                }\r\n              },\r\n              labelLine: {\r\n                show: false\r\n              },\r\n              data: usualDistributionData\r\n            }\r\n          ]\r\n        };\r\n        myChart.setOption(option);\r\n\r\n        let option2 = JSON.parse(JSON.stringify(option));\r\n        option2.title.text = \"考试成绩\"\r\n        option2.series[0].data = finalDistributionData;\r\n        myChart2.setOption(option2);\r\n\r\n        let option3 = JSON.parse(JSON.stringify(option));\r\n        option3.title.text = \"综合成绩\"\r\n        option3.series[0].data = totalDistributionData;\r\n        myChart3.setOption(option3);\r\n\r\n        // 算平均分\r\n        let usualSum = 0, finalSum = 0, totalSum = 0;\r\n        for (let i = 0; i < this.tableData.length; i++) {\r\n          usualSum += this.tableData[i].usualGrade;\r\n          finalSum += this.tableData[i].finalGrade;\r\n          totalSum += this.tableData[i].totalGrade;\r\n        }\r\n        console.log(usualSum)\r\n        console.log(finalSum)\r\n        console.log(totalSum)\r\n        this.usualAverage = (usualSum / this.tableData.length).toFixed(2);\r\n        this.finalAverage = (finalSum / this.tableData.length).toFixed(2);\r\n        this.totalAverage = (totalSum / this.tableData.length).toFixed(2);\r\n      })\r\n    },\r\n    initDistributionData(distributionData, which) {\r\n      let t;\r\n      for (let i = 0; i < this.tableData.length; i++) {\r\n        if (which === 1) {\r\n          t = this.tableData[i].usualGrade\r\n        } else if (which === 2) {\r\n          t = this.tableData[i].finalGrade\r\n        } else {\r\n          t = this.tableData[i].totalGrade\r\n        }\r\n        if (t >= 90 && t <= 100) {\r\n          distributionData[0][\"value\"]++;\r\n        } else if (t >= 80 && t <= 89) {\r\n          distributionData[1][\"value\"]++;\r\n        } else if (t >= 70 && t <= 79) {\r\n          distributionData[2][\"value\"]++;\r\n        } else if (t >= 60 && t <= 69) {\r\n          distributionData[3][\"value\"]++;\r\n        } else {\r\n          distributionData[4][\"value\"]++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module"}