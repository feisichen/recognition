{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vShow as _vShow, withDirectives as _withDirectives, resolveComponent as _resolveComponent, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-588de41c\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"tool-bar\"\n};\nconst _hoisted_2 = {\n  class: \"pageNum\"\n};\n\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"txt\"\n}, \"放大\", -1\n/* HOISTED */\n));\n\nconst _hoisted_4 = {\n  class: \"box\"\n};\nconst _hoisted_5 = {\n  class: \"mask\"\n};\n\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"txt\"\n}, \"缩小\", -1\n/* HOISTED */\n));\n\nconst _hoisted_7 = {\n  class: \"box\"\n};\nconst _hoisted_8 = {\n  class: \"mask\"\n};\nconst _hoisted_9 = [\"id\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_van_icon = _resolveComponent(\"van-icon\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createCommentVNode(\" 自由发挥想象的工具栏 \"), _withDirectives(_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, _toDisplayString(_ctx.currentPageNum) + \" / \" + _toDisplayString(_ctx.totalPageNum) + \"页\", 1\n  /* TEXT */\n  ), _hoisted_3, _createElementVNode(\"div\", _hoisted_4, [_withDirectives(_createElementVNode(\"div\", _hoisted_5, null, 512\n  /* NEED_PATCH */\n  ), [[_vShow, _ctx.zoom == _ctx.maxZoom]]), _createVNode(_component_van_icon, {\n    name: \"plus\",\n    size: \"18\",\n    onClick: _cache[0] || (_cache[0] = $event => $setup.zoomChange('plus'))\n  })]), _hoisted_6, _createElementVNode(\"div\", _hoisted_7, [_withDirectives(_createElementVNode(\"div\", _hoisted_8, null, 512\n  /* NEED_PATCH */\n  ), [[_vShow, _ctx.zoom == _ctx.minZoom]]), _createVNode(_component_van_icon, {\n    name: \"minus\",\n    size: \"18\",\n    onClick: _cache[1] || (_cache[1] = $event => $setup.zoomChange('minus'))\n  })])], 512\n  /* NEED_PATCH */\n  ), [[_vShow, _ctx.totalPageNum != 0]]), _createCommentVNode(\" 工具栏 end \"), _createElementVNode(\"div\", {\n    class: \"pdf-viewer\",\n    onScroll: _cache[2] || (_cache[2] = (...args) => $setup.onScroll && $setup.onScroll(...args))\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.totalPageNum, item => {\n    return _openBlock(), _createElementBlock(\"canvas\", {\n      key: item,\n      class: \"pdf-item\",\n      id: `pdf-canvas-${item}`,\n      style: _normalizeStyle({\n        zoom: _ctx.zoom / 10\n      })\n    }, null, 12\n    /* STYLE, PROPS */\n    , _hoisted_9);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))], 32\n  /* HYDRATE_EVENTS */\n  )], 64\n  /* STABLE_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":"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","names":["class","_createElementVNode","_createCommentVNode","_toDisplayString","_ctx","_hoisted_3","_createVNode","_component_van_icon","name","size","onClick","$setup","_hoisted_6","onScroll","_createElementBlock","_Fragment","_renderList","item","id","style","zoom"],"sourceRoot":"","sources":["E:\\code\\springboot+vue\\class_choose_book1\\vue\\src\\components\\Pdf.vue"],"sourcesContent":["<template>\r\n  <!-- 自由发挥想象的工具栏 -->\r\n  <div class=\"tool-bar\" v-show=\"totalPageNum != 0\">\r\n    <div class=\"pageNum\">{{currentPageNum}} / {{totalPageNum}}页</div>\r\n    <span class=\"txt\">放大</span>\r\n    <div class=\"box\">\r\n      <div class=\"mask\" v-show=\"zoom == maxZoom\"></div>\r\n      <van-icon name=\"plus\" size=\"18\" @click=\"zoomChange('plus')\"/>\r\n    </div>\r\n    <span class=\"txt\">缩小</span>\r\n    <div class=\"box\">\r\n      <div class=\"mask\" v-show=\"zoom == minZoom\"></div>\r\n      <van-icon name=\"minus\" size=\"18\" @click=\"zoomChange('minus')\"/>\r\n    </div>\r\n  </div>\r\n  <!-- 工具栏 end -->\r\n\r\n  <div class=\"pdf-viewer\" @scroll=\"onScroll\">\r\n    <template v-for=\"item in totalPageNum\" :key=\"item\">\r\n      <canvas class=\"pdf-item\" :id=\"`pdf-canvas-${item}`\" :style=\"{zoom: zoom/10}\" />\r\n    </template>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { reactive, toRefs, nextTick, watchEffect } from 'vue'\r\nimport * as pdfjs from 'pdfjs-dist'\r\nimport {GlobalWorkerOptions, getDocument} from 'pdfjs-dist'\r\nimport pdfjsWorker from 'pdfjs-dist/build/pdf.worker.entry';\r\nimport { Toast } from 'vant';\r\n\r\npdfjs.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\nexport default {\r\n  name: 'Pdf',\r\n  props: {\r\n    url: {type: String, default: 'PDF/test.pdf'} // pdf文件路径\r\n  },\r\n  setup (props, { emit }) {\r\n    const state = reactive({\r\n      pdfCtx: null,\r\n\r\n      currentPageNum: 0, // 当前页\r\n      totalPageNum: 0,\r\n      zoom: 10, // 目前暂时采用css方式缩放页面\r\n      minZoom: 10, // 缩放最小值 一倍\r\n      maxZoom: 50, // 缩放最大值 五倍\r\n    })\r\n\r\n    const resolvePdf = (url) => {\r\n      const loadingTask = pdfjs.getDocument(url)\r\n      loadingTask.promise.then(pdf => {\r\n        state.pdfCtx = pdf\r\n        state.totalPageNum = pdf.numPages\r\n        state.currentPageNum = 1\r\n\r\n        // 动态计算scale\r\n        pdf.getPage(1).then(res => {\r\n          let boxWidth = document.body.clientWidth - 20\r\n          const [x1, , x2] = res._pageInfo.view;\r\n          const pageWidth = x2 - x1;\r\n          state.scale = boxWidth*(state.maxZoom/10) / pageWidth\r\n        })\r\n        nextTick(() => {\r\n          renderPdf()\r\n        })\r\n      })\r\n    }\r\n\r\n    const renderPdf = (num = 1) => {\r\n      state.pdfCtx.getPage(num).then(page => {\r\n        const canvas = document.getElementById(`pdf-canvas-${num}`)\r\n        const ctx = canvas.getContext('2d')\r\n        const viewport = page.getViewport({ scale: state.scale })\r\n        // 画布大小,默认值是width:300px,height:150px\r\n        canvas.width = viewport.width\r\n        canvas.height = viewport.height\r\n        // 画布的dom大小, 设置移动端,宽度设置铺满整个屏幕\r\n        const clientWidth = document.body.clientWidth - 20\r\n        canvas.style.width = clientWidth + 'px'\r\n        // 根据pdf每页的宽高比例设置canvas的高度\r\n        canvas.style.height = clientWidth * (viewport.height / viewport.width) + 'px'\r\n        page.render({\r\n          canvasContext: ctx,\r\n          viewport\r\n        })\r\n        if (num < state.totalPageNum) {\r\n          renderPdf(num + 1)\r\n        } else {\r\n          emit('onRendered')\r\n          Toast.clear();\r\n        }\r\n      })\r\n    }\r\n\r\n    const zoomChange = (value) => {\r\n      state.zoom = value == 'plus' ? state.zoom + 5 : state.zoom - 5\r\n\r\n      let pdfViewer = document.getElementsByClassName('pdf-viewer')[0]\r\n      let pages = document.getElementsByClassName('pdf-item')\r\n      pdfViewer.scrollTop = pages[state.currentPageNum-1].offsetTop*state.zoom/10\r\n    }\r\n\r\n    const onScroll = (e) => {\r\n      let pages = document.getElementsByClassName('pdf-item')\r\n      for (let i=0; i<state.totalPageNum; i++) {\r\n        let offset = e.target.offsetHeight/2-100 // 距顶部的距离(当前页在滚动到页面可视区的哪个位置时更改currentPageNum)\r\n        if (e.target.scrollTop >= pages[i].offsetTop*state.zoom/10 - offset ) {\r\n          if ((pages[i+1] && e.target.scrollTop < pages[i+1].offsetTop*state.zoom/10 - offset) || !pages[i+1]) {\r\n            state.currentPageNum = i+1\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    watchEffect(() => {\r\n      if (props.url) {\r\n        Toast.loading({\r\n          message: '文件加载中...',\r\n          overlay: true,\r\n          forbidClick: true,\r\n          duration: 0,\r\n        });\r\n\r\n        resolvePdf(props.url)\r\n      }\r\n    })\r\n    return {\r\n      ...toRefs(state),\r\n      zoomChange,\r\n      onScroll\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.pdf-viewer {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 10px 10px 50px;\r\n  overflow: scroll;\r\n  background-color: #f5f5f5;\r\n}\r\n// 放飞自我的工具栏\r\n.tool-bar {\r\n  z-index: 2;\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 45px;\r\n  line-height: 45px;\r\n  color: #fff;\r\n  padding: 0 20px;\r\n  background-color: rgba(85, 85, 85, 0.6);\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  .pageNum {\r\n    flex: 1;\r\n    font-size: 17px;\r\n  }\r\n  .txt {\r\n    font-size: 16px;\r\n    padding-right: 5px;\r\n    margin-left: 20px;\r\n  }\r\n  .box {\r\n    position: relative;\r\n    margin-top: 5px;\r\n    width: 35px;\r\n    height: 35px;\r\n    line-height: 35px;\r\n    text-align: center;\r\n    background-color: #3476FE;\r\n    border-radius: 50%;\r\n    .van-icon {\r\n      vertical-align: middle;\r\n      font-weight: bold;\r\n    }\r\n    .mask {\r\n      z-index: 1;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      background-color: rgba(109, 109, 109, .7);\r\n      border-radius: 50%;\r\n    }\r\n  }\r\n  // 工具栏 end\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}